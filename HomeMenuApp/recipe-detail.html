// js/recipe-detail.js
document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("access_token"); // Ensure consistency with login.js
  if (!token) {
    alert("Please log in first!");
    window.location.href = "login.html";
    return;
  }

  const recipeTitle = document.getElementById("recipe-title");
  const recipeDescription = document.getElementById("recipe-description");
  const ingredientsList = document.getElementById("ingredients-list");
  const recipeInstructions = document.getElementById("recipe-instructions");
  const backBtn = document.getElementById("back-btn");

  // Get recipe ID from URL
  const params = new URLSearchParams(window.location.search);
  const recipeId = params.get("id");
  if (!recipeId) {
    recipeTitle.textContent = "Recipe not found.";
    return;
  }

  // Fetch recipe details
  try {
    const res = await axios.get(`https://your-backend-domain.com/api/recipes/${recipeId}/`, {
      headers: { Authorization: `Bearer ${token}` }
    });

    const recipe = res.data;

    // Render recipe details
    recipeTitle.textContent = recipe.title || "No title";
    recipeDescription.textContent = recipe.description || "No description available.";
    recipeInstructions.textContent = recipe.instructions || "No instructions provided.";

    // Render ingredients
    ingredientsList.innerHTML = "";
    if (recipe.ingredients && recipe.ingredients.length > 0) {
      recipe.ingredients.forEach(ing => {
        const li = document.createElement("li");
        li.textContent = `${ing.name} (${ing.quantity || ""} ${ing.unit || ""})`;
        ingredientsList.appendChild(li);
      });
    } else {
      ingredientsList.innerHTML = "<li>No ingredients listed.</li>";
    }

  } catch (err) {
    console.error("Error fetching recipe details:", err);
    recipeTitle.textContent = "Failed to load recipe details.";
    recipeDescription.textContent = "";
    recipeInstructions.textContent = "";
    ingredientsList.innerHTML = "<li></li>";
  }

  // Back button
  backBtn.addEventListener("click", () => {
    window.location.href = "recipes.html";
  });
});
